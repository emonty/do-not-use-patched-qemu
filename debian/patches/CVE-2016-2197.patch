Description: add check before calling dma_memory_unmap
Origin: other, https://lists.gnu.org/archive/html/qemu-devel/2016-01/msg05740.html

Index: qemu-2.5+dfsg/hw/ide/ahci.c
===================================================================
--- qemu-2.5+dfsg.orig/hw/ide/ahci.c	2016-02-01 09:36:12.498782016 -0500
+++ qemu-2.5+dfsg/hw/ide/ahci.c	2016-02-01 09:37:34.315735201 -0500
@@ -661,9 +661,11 @@
 
 static void ahci_unmap_fis_address(AHCIDevice *ad)
 {
-    dma_memory_unmap(ad->hba->as, ad->res_fis, 256,
-                     DMA_DIRECTION_FROM_DEVICE, 256);
-    ad->res_fis = NULL;
+    if (ad->res_fis) {
+        dma_memory_unmap(ad->hba->as, ad->res_fis, 256,
+                         DMA_DIRECTION_FROM_DEVICE, 256);
+        ad->res_fis = NULL;
+    }
 }
 
 static bool ahci_map_clb_address(AHCIDevice *ad)
@@ -677,9 +679,11 @@
 
 static void ahci_unmap_clb_address(AHCIDevice *ad)
 {
-    dma_memory_unmap(ad->hba->as, ad->lst, 1024,
-                     DMA_DIRECTION_FROM_DEVICE, 1024);
-    ad->lst = NULL;
+    if (ad->lst) {
+        dma_memory_unmap(ad->hba->as, ad->lst, 1024,
+                         DMA_DIRECTION_FROM_DEVICE, 1024);
+        ad->lst = NULL;
+    }
 }
 
 static void ahci_write_fis_sdb(AHCIState *s, NCQTransferState *ncq_tfs)
